
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Using neuroboros on Discovery</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Searchlight hyperalignment" href="simple_hyperalignment.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo_name_blk.png" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    neuroboros: Neuroimaging analysis in Python
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tutorials
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="setup.html">
   Setup environment for Colab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="neuroimaging_data_matrix.html">
   Neuroimaging data as a matrix
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="simple_hyperalignment.html">
   Searchlight hyperalignment
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Using
   <code class="docutils literal notranslate">
    <span class="pre">
     neuroboros
    </span>
   </code>
   on Discovery
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/neuroboros/neuroboros.github.io"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/neuroboros/neuroboros.github.io/issues/new?title=Issue%20on%20page%20%2Ftutorials/discovery.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/tutorials/discovery.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#linking-the-data-directory">
   Linking the data directory
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#submitting-an-interactive-job">
   Submitting an interactive job
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#time-and-memory-usage">
     Time and memory usage
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#converting-a-jupyter-notebook-to-a-python-script">
     Converting a Jupyter notebook to a Python script
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#submitting-a-batch-job">
   Submitting a batch job
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#submitting-an-array-of-jobs">
   Submitting an array of jobs
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Using neuroboros on Discovery</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#linking-the-data-directory">
   Linking the data directory
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#submitting-an-interactive-job">
   Submitting an interactive job
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#time-and-memory-usage">
     Time and memory usage
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#converting-a-jupyter-notebook-to-a-python-script">
     Converting a Jupyter notebook to a Python script
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#submitting-a-batch-job">
   Submitting a batch job
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#submitting-an-array-of-jobs">
   Submitting an array of jobs
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="using-neuroboros-on-discovery">
<h1>Using <code class="docutils literal notranslate"><span class="pre">neuroboros</span></code> on Discovery<a class="headerlink" href="#using-neuroboros-on-discovery" title="Permalink to this headline">#</a></h1>
<div class="section" id="linking-the-data-directory">
<h2>Linking the data directory<a class="headerlink" href="#linking-the-data-directory" title="Permalink to this headline">#</a></h2>
<p><a class="reference external" href="https://rc.dartmouth.edu/index.php/discovery-overview/">Discovery</a> is the high-performance computing (HPC) cluster of Dartmouth College. If you are using <code class="docutils literal notranslate"><span class="pre">neuroboros</span></code> on Discovery, you can take advantage of the datasets that are already available on the cluster through <a class="reference external" href="https://rc.dartmouth.edu/index.php/draft/data-storage-dartfs/">DartFS</a>. What you need to do is to create a symbolic link to the data directory in your home directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ln -s /dartfs/rc/lab/H/HaxbyLab/feilong/nb-data <span class="nv">$HOME</span>/.neuroboros-data
</pre></div>
</div>
</div>
<div class="section" id="submitting-an-interactive-job">
<h2>Submitting an interactive job<a class="headerlink" href="#submitting-an-interactive-job" title="Permalink to this headline">#</a></h2>
<p>Currently, Discovery uses the SLURM job submission system. To test your job on Discovery, you can submit an interactive job with the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>srun --nodes<span class="o">=</span><span class="m">1</span> --ntasks-per-node<span class="o">=</span><span class="m">1</span> --mem<span class="o">=</span>8GB --cpus-per-task<span class="o">=</span><span class="m">1</span> <span class="se">\</span>
    -t <span class="m">24</span>:00:00 -A DBIC --pty /bin/bash
</pre></div>
</div>
<p>This command requires 1 CPU, 8GB memory, and 24 hours of walltime. You can change these parameters according to your needs.
If you have a different account other than DBIC, you need to change the <code class="docutils literal notranslate"><span class="pre">-A</span></code> parameter accordingly.</p>
<div class="section" id="time-and-memory-usage">
<h3>Time and memory usage<a class="headerlink" href="#time-and-memory-usage" title="Permalink to this headline">#</a></h3>
<p>When you test your script using an interactive job, make sure that you record the execution time and memory usage of your script. This will help you to decide the required walltime and memory for your actual job. You can use the <code class="docutils literal notranslate"><span class="pre">time</span></code> command to record the execution time of your script:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/bin/time -v python my_script.py
</pre></div>
</div>
</div>
<div class="section" id="converting-a-jupyter-notebook-to-a-python-script">
<h3>Converting a Jupyter notebook to a Python script<a class="headerlink" href="#converting-a-jupyter-notebook-to-a-python-script" title="Permalink to this headline">#</a></h3>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p>If the notebook’s filename is <code class="docutils literal notranslate"><span class="pre">my_script.ipynb</span></code> as in the example, the converted Python script will be saved as <code class="docutils literal notranslate"><span class="pre">my_script.py</span></code>.</p>
</div>
<p>If your script is a Jupyter notebook, you can convert it to a Python script with the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>jupyter nbconvert --to python my_script.ipynb
</pre></div>
</div>
</div>
</div>
<div class="section" id="submitting-a-batch-job">
<h2>Submitting a batch job<a class="headerlink" href="#submitting-a-batch-job" title="Permalink to this headline">#</a></h2>
<p>When you are ready to submit your job, you can write a job submission script. Here is an example job submission script:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1">#SBATCH --job-name=jobname</span>
<span class="c1">#SBATCH -A DBIC</span>
<span class="c1">#SBATCH --nodes=1</span>
<span class="c1">#SBATCH --ntasks-per-node=1</span>
<span class="c1">#SBATCH --cpus-per-task=1</span>
<span class="c1">#SBATCH --mem=8G</span>
<span class="c1">#SBATCH --time=24:00:00</span>
<span class="c1">#SBATCH --partition=standard</span>
<span class="c1">#SBATCH -o logs/%A_%a_%j.out</span>
<span class="c1">#SBATCH -e logs/%A_%a_%j.err</span>
<span class="c1">#SBATCH --nice=999</span>

<span class="c1"># Set up the Python environment</span>
module unload python
<span class="nv">__conda_setup</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span><span class="s1">&#39;/optnfs/python/el7/3.7-Anaconda/bin/conda&#39;</span> <span class="s1">&#39;shell.bash&#39;</span> <span class="s1">&#39;hook&#39;</span> <span class="m">2</span>&gt; /dev/null<span class="k">)</span><span class="s2">&quot;</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -eq <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">eval</span> <span class="s2">&quot;</span><span class="nv">$__conda_setup</span><span class="s2">&quot;</span>
<span class="k">else</span>
    <span class="k">if</span> <span class="o">[</span> -f <span class="s2">&quot;/optnfs/python/el7/3.7-Anaconda/etc/profile.d/conda.sh&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
        . <span class="s2">&quot;/optnfs/python/el7/3.7-Anaconda/etc/profile.d/conda.sh&quot;</span>
    <span class="k">else</span>
        <span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;/optnfs/python/el7/3.7-Anaconda/bin:</span><span class="nv">$PATH</span><span class="s2">&quot;</span>
    <span class="k">fi</span>
<span class="k">fi</span>
<span class="nb">unset</span> __conda_setup
conda activate tc

<span class="c1"># Run the script</span>
python my_script.py
</pre></div>
</div>
<p>Suppose the job submission script is saved as <code class="docutils literal notranslate"><span class="pre">submit.sh</span></code>. You can submit the job with the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sbatch submit.sh
</pre></div>
</div>
<p>When you submit the job, make sure the log directory exists. In the example above, the log directory is <code class="docutils literal notranslate"><span class="pre">logs/</span></code>. You can create the log directory with the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir logs
</pre></div>
</div>
<p>If you want to know more about the SLURM job submission system, you can check out the <a class="reference external" href="https://slurm.schedmd.com/documentation.html">SLURM documentation</a>.</p>
</div>
<div class="section" id="submitting-an-array-of-jobs">
<h2>Submitting an array of jobs<a class="headerlink" href="#submitting-an-array-of-jobs" title="Permalink to this headline">#</a></h2>
<p>When you need to run multiple jobs, you can change the job submission script to submit an array of jobs. You just need to add the following line to the job submission script:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#SBATCH --array=0-9</span>
</pre></div>
</div>
<p>or add the parameter to the <code class="docutils literal notranslate"><span class="pre">sbatch</span></code> command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sbatch</span> <span class="o">--</span><span class="n">array</span><span class="o">=</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span> <span class="n">submit</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>This will submit 10 jobs with the same script, where each job has a different job array index from 0 to 9. The job array index is stored in the environment variable <code class="docutils literal notranslate"><span class="pre">SLURM_ARRAY_TASK_ID</span></code>. You can use this variable as an input to your Python script. For example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python my_script.py <span class="nv">$SLURM_ARRAY_TASK_ID</span>
</pre></div>
</div>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p>See <a class="reference external" href="https://docs.python.org/3/library/sys.html#sys.argv">here</a> on how to access command-line arguments in Python using <code class="docutils literal notranslate"><span class="pre">sys.argv</span></code>.</p>
</div>
<p>In your Python script, you can use <code class="docutils literal notranslate"><span class="pre">sys.argv[1]</span></code> to access the job array index (in this case <code class="docutils literal notranslate"><span class="pre">sys.argv[0]</span></code> will be <code class="docutils literal notranslate"><span class="pre">my_script.py</span></code>). For example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">arg</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./tutorials"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="simple_hyperalignment.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Searchlight hyperalignment</p>
        </div>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By the neuroboros developers<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>